{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams}from'react-router-dom';import{ToastContainer,toast}from'react-toastify';import'./css/Page3.css';import Header from'./Header';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Page3=()=>{const[data,setData]=useState([]);const{id}=useParams();const[currentIdIndex,setCurrentIdIndex]=useState(0);const[list,setList]=useState([]);const[concatenatedString,setConcatenatedString]=useState('');const[availableIndexes,setAvailableIndexes]=useState([]);// Mảng lưu trữ các index có sẵn\nconst[currentAvailableIndex,setCurrentAvailableIndex]=useState(0);const[loaded,setLoaded]=useState(false);// Biến đánh dấu đã tải dữ liệu hay chưa\nconst[prizeData,setPrizeData]=useState(null);useEffect(()=>{const fetchPrizeData=async()=>{try{const response=await fetch('https://lotteryapi20231223201647.azurewebsites.net/api/Prize/'+id);// Thay đổi URL của API theo đúng đường dẫn của bạn\nif(!response.ok){throw new Error('Failed to fetch prize data');}const prize=await response.json();setPrizeData(prize);}catch(error){console.error('Error fetching prize data:',error.message);}};fetchPrizeData();},[]);useEffect(()=>{// Chỉ tải dữ liệu nếu loaded là false\nif(!loaded){const fetchData=async()=>{try{const response=await fetch('https://lotteryapi20231223201647.azurewebsites.net//api/Member/TestSheet');if(!response.ok){throw new Error('Failed to fetch data');}const result=await response.json();setData(result);setAvailableIndexes(Array.from({length:result.length},(_,index)=>index));setLoaded(true);// Đặt loaded thành true sau khi tải dữ liệu\n}catch(error){console.error('Error fetching data:',error.message);}};fetchData();}},[loaded]);useEffect(()=>{// Tạo interval để chuyển đổi id mỗi giây\nconst intervalId=setInterval(()=>{if(availableIndexes.length>0){const randomIndex=Math.floor(Math.random()*availableIndexes.length);setCurrentIdIndex(availableIndexes[randomIndex]);setCurrentAvailableIndex(randomIndex);}else{setAvailableIndexes(Array.from({length:data.length},(_,index)=>index));}},100);return()=>clearInterval(intervalId);},[availableIndexes]);if(!prizeData){return/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"});}const updateData=async(memberId,prizeId)=>{try{const response=await fetch(\"https://lotteryapi20231223201647.azurewebsites.net//api/Prize/\".concat(memberId,\"/\").concat(prizeId),{method:'PUT',headers:{'Content-Type':'application/json'}});if(!response.ok){throw new Error('Failed to update data');}console.log('Data updated successfully');}catch(error){console.error('Error updating data:',error.message);}};const handleConcatenate=async()=>{if(list.length<prizeData.quantity){setList(prevList=>[data[currentIdIndex],...prevList]);await updateData(data[currentIdIndex].id,id);list.push(data[currentIdIndex]);// Tạo một bản sao mới của mảng availableIndexes và loại bỏ phần tử tương ứng\nsetAvailableIndexes(prevIndexes=>{const newIndexes=[...prevIndexes];newIndexes.splice(currentAvailableIndex,1);return newIndexes;});}else{toast(\"Đã đủ giải thưởng\");}};if(prizeData.quantity==prizeData.members.length){return/*#__PURE__*/_jsxs(\"div\",{className:\"bodyPage3\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(\"div\",{className:\"mainPage3\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"S\\u1ED1 ph\\u1EA7n th\\u01B0\\u1EDFng \\u0111\\xE3 h\\u1EBFt\"})})]});}else return/*#__PURE__*/_jsxs(\"div\",{className:\"bodyPage3\",children:[/*#__PURE__*/_jsx(ToastContainer,{}),/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"mainPage3\",children:[/*#__PURE__*/_jsx(\"h2\",{children:prizeData.prizeName}),/*#__PURE__*/_jsxs(\"h3\",{children:[prizeData.prizeDescription,\" (\",prizeData.quantity,\" gi\\u1EA3i)\"]}),/*#__PURE__*/_jsx(\"img\",{className:\"imgPrize\",src:prizeData.imageLink}),/*#__PURE__*/_jsxs(\"p\",{children:[data.length>0&&data[currentIdIndex].memberName,\" - \",data.length>0&&data[currentIdIndex].phoneNumber]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleConcatenate,children:\"D\\u1EEBng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"listWin\",children:/*#__PURE__*/_jsx(\"ul\",{children:list.map((item,index)=>/*#__PURE__*/_jsxs(\"li\",{children:[item.memberName,\" - \",item.phoneNumber,\" \"]},index.id))})})]})]});};export default Page3;","map":{"version":3,"names":["React","useState","useEffect","useParams","ToastContainer","toast","Header","jsx","_jsx","jsxs","_jsxs","Page3","data","setData","id","currentIdIndex","setCurrentIdIndex","list","setList","concatenatedString","setConcatenatedString","availableIndexes","setAvailableIndexes","currentAvailableIndex","setCurrentAvailableIndex","loaded","setLoaded","prizeData","setPrizeData","fetchPrizeData","response","fetch","ok","Error","prize","json","error","console","message","fetchData","result","Array","from","length","_","index","intervalId","setInterval","randomIndex","Math","floor","random","clearInterval","children","updateData","memberId","prizeId","concat","method","headers","log","handleConcatenate","quantity","prevList","push","prevIndexes","newIndexes","splice","members","className","prizeName","prizeDescription","src","imageLink","memberName","phoneNumber","onClick","map","item"],"sources":["C:/Users/Hii/Desktop/Manager/manager/src/components/Page3.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport './css/Page3.css';\r\nimport Header from './Header';\r\n\r\nconst Page3 = () => {\r\n    const [data, setData] = useState([]);\r\n    const { id } = useParams();\r\n    const [currentIdIndex, setCurrentIdIndex] = useState(0);\r\n    const [list, setList] = useState([]);\r\n    const [concatenatedString, setConcatenatedString] = useState('');\r\n    const [availableIndexes, setAvailableIndexes] = useState([]); // Mảng lưu trữ các index có sẵn\r\n    const [currentAvailableIndex, setCurrentAvailableIndex] = useState(0);\r\n    const [loaded, setLoaded] = useState(false); // Biến đánh dấu đã tải dữ liệu hay chưa\r\n    const [prizeData, setPrizeData] = useState(null);\r\n\r\n\r\n    useEffect(() => {\r\n        const fetchPrizeData = async () => {\r\n            try {\r\n                const response = await fetch('https://lotteryapi20231223201647.azurewebsites.net/api/Prize/' + id); // Thay đổi URL của API theo đúng đường dẫn của bạn\r\n                if (!response.ok) {\r\n                    throw new Error('Failed to fetch prize data');\r\n                }\r\n\r\n                const prize = await response.json();\r\n                setPrizeData(prize);\r\n            } catch (error) {\r\n                console.error('Error fetching prize data:', error.message);\r\n            }\r\n        };\r\n\r\n        fetchPrizeData();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // Chỉ tải dữ liệu nếu loaded là false\r\n        if (!loaded) {\r\n            const fetchData = async () => {\r\n                try {\r\n                    const response = await fetch('https://lotteryapi20231223201647.azurewebsites.net//api/Member/TestSheet');\r\n                    if (!response.ok) {\r\n                        throw new Error('Failed to fetch data');\r\n                    }\r\n                    const result = await response.json();\r\n                    setData(result);\r\n                    setAvailableIndexes(Array.from({ length: result.length }, (_, index) => index));\r\n                    setLoaded(true); // Đặt loaded thành true sau khi tải dữ liệu\r\n\r\n                } catch (error) {\r\n                    console.error('Error fetching data:', error.message);\r\n                }\r\n            }\r\n\r\n            fetchData();\r\n        }\r\n    }, [loaded]);\r\n\r\n    useEffect(() => {\r\n        // Tạo interval để chuyển đổi id mỗi giây\r\n        const intervalId = setInterval(() => {\r\n            if (availableIndexes.length > 0) {\r\n                const randomIndex = Math.floor(Math.random() * availableIndexes.length);\r\n                setCurrentIdIndex(availableIndexes[randomIndex]);\r\n                setCurrentAvailableIndex(randomIndex);\r\n            } else {\r\n                setAvailableIndexes(Array.from({ length: data.length }, (_, index) => index));\r\n            }\r\n        }, 100);\r\n\r\n        return () => clearInterval(intervalId);\r\n    }, [availableIndexes]);\r\n    if (!prizeData) {\r\n        return <p>Loading...</p>;\r\n    }\r\n\r\n    const updateData = async (memberId, prizeId) => {\r\n        try {\r\n            const response = await fetch(`https://lotteryapi20231223201647.azurewebsites.net//api/Prize/${memberId}/${prizeId}`, {\r\n                method: 'PUT',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                }\r\n            });\r\n\r\n            if (!response.ok) {\r\n                throw new Error('Failed to update data');\r\n            }\r\n            console.log('Data updated successfully');\r\n        } catch (error) {\r\n            console.error('Error updating data:', error.message);\r\n        }\r\n    };\r\n\r\n    const handleConcatenate = async () => {\r\n\r\n        if (list.length < prizeData.quantity) {\r\n            setList(prevList => [data[currentIdIndex], ...prevList]);\r\n            await updateData(data[currentIdIndex].id, id);\r\n            list.push(data[currentIdIndex]);\r\n            // Tạo một bản sao mới của mảng availableIndexes và loại bỏ phần tử tương ứng\r\n            setAvailableIndexes(prevIndexes => {\r\n                const newIndexes = [...prevIndexes];\r\n                newIndexes.splice(currentAvailableIndex, 1);\r\n                return newIndexes;\r\n            });\r\n        } else {\r\n            toast(\"Đã đủ giải thưởng\");\r\n        }\r\n    };\r\n    if (prizeData.quantity == prizeData.members.length) {\r\n        return (\r\n            <div className='bodyPage3'>\r\n                <Header />\r\n                <div className='mainPage3'>\r\n                    <h2>Số phần thưởng đã hết</h2>\r\n                </div>\r\n            </div>\r\n        );\r\n    } else\r\n\r\n        return (\r\n            <div className='bodyPage3'>\r\n                <ToastContainer />\r\n                <Header />\r\n                <div className='mainPage3'>\r\n                    <h2>{prizeData.prizeName}</h2>\r\n                    <h3>{prizeData.prizeDescription} ({prizeData.quantity} giải)</h3>\r\n                    <img className='imgPrize' src={prizeData.imageLink} />\r\n                    <p>{data.length > 0 && data[currentIdIndex].memberName} - {data.length > 0 && data[currentIdIndex].phoneNumber}</p>\r\n                    <button onClick={handleConcatenate}>Dừng</button>\r\n                    <div className='listWin'>\r\n                        <ul>\r\n                            {list.map((item, index) => (\r\n                                <li key={index.id}>{item.memberName} - {item.phoneNumber} </li>\r\n                            ))}\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n};\r\n\r\n\r\nexport default Page3;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}